generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  EMPLOYEE
  MANAGER
  HR
  BUSINESS_HEAD
  ADMIN
}

enum Status {
  ACTIVE
  BLOCKED
}

enum LeaveType {
  CASUAL
  SICK
  PAID
  HALF_DAY
  FULL_DAY
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id                  Int       @id @default(autoincrement())
  email               String    @unique
  password            String
  name                String
  role                Role      @default(EMPLOYEE)
  designation         String    @default("LA") // LA, CRE, FA, AE
  status              Status    @default(ACTIVE)
  lastWorkLogDate     DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  attendance          Attendance[]
  workLogs            WorkLog[]
  leaveRequests       LeaveRequest[]
  permissionRequests  PermissionRequest[]
  loginAccessRequests LoginAccessRequest[]
  managedProjects     Project[]
}

model Attendance {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  date          DateTime @default(now())
  status        String   @default("PRESENT")
  checkoutTime  DateTime?
  createdAt     DateTime @default(now())
  
  @@unique([userId, date])
}

model WorkLog {
  id              Int      @id @default(autoincrement())
  userId          Int
  user            User     @relation(fields: [userId], references: [id])
  date            DateTime @default(now())
  projectId       Int?
  project         Project? @relation(fields: [projectId], references: [id])
  projectName     String?  // Can act as "Client Name" if needed, or specific field below
  
  // Architect Fields (LA)
  clientName      String?
  site            String?
  process         String?
  imageCount      Int?
  startTime       String?
  endTime         String?
  hours           Float?   // Keeping for backward compatibility/total time calculation
  completedImages Int?
  pendingImages   Int?
  
  // CRE Fields
  cre_totalCalls      Int?
  cre_showroomVisits  Int?
  cre_fqSent          Int?
  cre_orders          Int?
  cre_proposals       Int?
  cre_callBreakdown   String? // For storing the "9* - 2, 8* - 3" detailed breakdown as text

  // FA Fields
  fa_calls                   Int?
  fa_designPending           Int?
  fa_designPendingClients    String?
  fa_quotePending            Int?
  fa_quotePendingClients     String?
  fa_initialQuoteRn          Int?
  fa_revisedQuoteRn          Int?
  fa_showroomVisits          Int?
  fa_showroomVisitClients    String?
  fa_onlineDiscussion        Int?
  fa_onlineDiscussionClients String?
  fa_siteVisits              Int?
  fa_loadingDiscussion       Int?
  fa_bookingFreezed          Int?
  fa_bookingFreezedClients   String?

  // Loading Architect (LA) Detailed Fields
  la_number           String?
  la_mailId           String?
  la_projectLocation  String?
  la_freezingAmount   String?
  la_variant          String?
  la_projectValue     String?
  la_woodwork         String?
  la_addOns           String?
  la_cpCode           String?
  la_source           String?
  la_fa               String?
  la_referalBonus     String?
  la_siteStatus       String?
  la_specialNote      String?

  // JSON fields for tables/lists
  la_requirements     Json?     // List of requirements strings
  la_colours          Json?     // List of colour strings
  la_onlineMeeting    Json?     // Array of { slNo, date, discussedOn }
  la_showroomMeeting  Json?     // Array of { slNo, date, discussedOn }
  la_measurements     Json?     // Array of { aeName, date, discussedOn }

  tasks           String?   // Making optional if 'process' takes over
  remarks         String?
  createdAt       DateTime @default(now())
}

model LeaveRequest {
  id        Int           @id @default(autoincrement())
  userId    Int
  user      User          @relation(fields: [userId], references: [id])
  type      LeaveType
  startDate DateTime
  endDate   DateTime
  reason    String
  status    RequestStatus @default(PENDING)
  approvedBy Int?
  createdAt DateTime      @default(now())
}

model PermissionRequest {
  id        Int           @id @default(autoincrement())
  userId    Int
  user      User          @relation(fields: [userId], references: [id])
  date      DateTime
  startTime String
  endTime   String
  reason    String
  status    RequestStatus @default(PENDING)
  approvedBy Int?
  createdAt DateTime      @default(now())
}

model LoginAccessRequest {
  id        Int           @id @default(autoincrement())
  userId    Int
  user      User          @relation(fields: [userId], references: [id])
  reason    String
  status    RequestStatus @default(PENDING)
  createdAt DateTime      @default(now())
}

model Project {
  id              Int       @id @default(autoincrement())
  name            String
  description     String?
  managerId       Int?
  manager         User?     @relation(fields: [managerId], references: [id])
  
  // LA Project Fields
  number          String?
  mailId          String?
  location        String?
  freezingAmount  String?
  variant         String?
  projectValue    String?
  woodwork        String?
  addOns          String?
  cpCode          String?
  source          String?
  fa              String?
  referalBonus    String?
  siteStatus      String?
  specialNote     String?
  
  // JSON fields for lists/tables
  requirements    Json?
  colours         Json?
  onlineMeeting   Json?
  showroomMeeting Json?
  measurements    Json?

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt @default(now())

  workLogs        WorkLog[]
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  action    String
  userId    Int?
  details   String?
  createdAt DateTime @default(now())
}
