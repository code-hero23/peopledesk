generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                           Int                    @id @default(autoincrement())
  email                        String                 @unique
  password                     String
  name                         String
  role                         Role                   @default(EMPLOYEE)
  status                       Status                 @default(ACTIVE)
  lastWorkLogDate              DateTime?
  createdAt                    DateTime               @default(now())
  updatedAt                    DateTime               @updatedAt
  designation                  String                 @default("LA")
  reportingBhId                Int?
  allocatedSalary              Float?                 @default(0)
  isGlobalAccess               Boolean                @default(false)
  salaryDeductions             Float?                 @default(0)
  salaryViewEnabled            Boolean                @default(false)
  salaryDeductionBreakdown     Json?                  @default("[]")
  timeShortageDeductionEnabled Boolean                @default(true)
  wfhViewEnabled               Boolean                @default(false)
  announcements                Announcement[]         @relation("AuthorAnnouncements")
  attendance                   Attendance[]
  leaveRequests                LeaveRequest[]
  loginAccessRequests          LoginAccessRequest[]
  permissionRequests           PermissionRequest[]
  managedProjects              Project[]
  showroomVisitRequests        ShowroomVisitRequest[]
  siteVisitRequests            SiteVisitRequest[]
  reportingBh                  User?                  @relation("ReportingLink", fields: [reportingBhId], references: [id])
  subordinates                 User[]                 @relation("ReportingLink")
  wfhRequests                  WfhRequest[]
  workLogs                     WorkLog[]
}

model SiteVisitRequest {
  id          Int           @id @default(autoincrement())
  userId      Int
  projectName String
  location    String
  date        DateTime
  startTime   String
  endTime     String
  reason      String
  targetBhId  Int?
  status      RequestStatus @default(PENDING)
  bhStatus    RequestStatus @default(PENDING)
  hrStatus    RequestStatus @default(PENDING)
  createdAt   DateTime      @default(now())
  user        User          @relation(fields: [userId], references: [id])
}

model ShowroomVisitRequest {
  id                  Int           @id @default(autoincrement())
  userId              Int
  date                DateTime
  startTime           String
  endTime             String
  sourceShowroom      String
  destinationShowroom String
  reason              String
  targetBhId          Int?
  status              RequestStatus @default(PENDING)
  bhStatus            RequestStatus @default(PENDING)
  hrStatus            RequestStatus @default(PENDING)
  createdAt           DateTime      @default(now())
  user                User          @relation(fields: [userId], references: [id])
}

model Attendance {
  id                 Int        @id @default(autoincrement())
  userId             Int
  date               DateTime   @default(now())
  status             String     @default("PRESENT")
  createdAt          DateTime   @default(now())
  checkInPhoto       String?
  checkoutPhoto      String?
  checkoutTime       DateTime?
  deviceInfo         String?
  ipAddress          String?
  checkoutDeviceInfo String?
  checkoutIpAddress  String?
  user               User       @relation(fields: [userId], references: [id])
  breaks             BreakLog[]

  @@unique([userId, date])
}

model BreakLog {
  id           Int        @id @default(autoincrement())
  attendanceId Int
  breakType    BreakType
  startTime    DateTime   @default(now())
  endTime      DateTime?
  duration     Int?
  attendance   Attendance @relation(fields: [attendanceId], references: [id])
}

model WorkLog {
  id                         Int       @id @default(autoincrement())
  userId                     Int
  date                       DateTime  @default(now())
  projectId                  Int?
  projectName                String?
  tasks                      String?
  hours                      Float?
  remarks                    String?
  createdAt                  DateTime  @default(now())
  ae_clientFeedback          String?
  ae_clientMet               Boolean?  @default(false)
  ae_gpsCoordinates          String?
  ae_hasIssues               Boolean?  @default(false)
  ae_issueDescription        String?
  ae_issueType               String?
  ae_issuesRaised            String?
  ae_issuesResolved          String?
  ae_itemsInstalled          String?
  ae_measurements            String?
  ae_nextVisitDate           DateTime?
  ae_nextVisitRequired       Boolean?  @default(false)
  ae_photos                  Json?
  ae_plannedWork             String?
  ae_siteLocation            String?
  ae_siteStatus              String?
  ae_tasksCompleted          Json?
  ae_visitType               Json?
  ae_workStage               String?
  clientName                 String?
  completedImages            Int?
  cre_callBreakdown          String?
  cre_fqSent                 Int?
  cre_orders                 Int?
  cre_proposals              Int?
  cre_showroomVisits         Int?
  cre_totalCalls             Int?
  customFields               Json?
  endTime                    String?
  fa_bookingFreezed          Int?
  fa_bookingFreezedClients   String?
  fa_calls                   Int?
  fa_designPending           Int?
  fa_designPendingClients    String?
  fa_initialQuoteRn          Int?
  fa_loadingDiscussion       Int?
  fa_onlineDiscussion        Int?
  fa_onlineDiscussionClients String?
  fa_onlineTime              String?
  fa_quotePending            Int?
  fa_quotePendingClients     String?
  fa_revisedQuoteRn          Int?
  fa_showroomTime            String?
  fa_showroomVisitClients    String?
  fa_showroomVisits          Int?
  fa_siteTime                String?
  fa_siteVisits              Int?
  imageCount                 Int?
  la_addOns                  String?
  la_colours                 Json?
  la_cpCode                  String?
  la_fa                      String?
  la_freezingAmount          String?
  la_mailId                  String?
  la_measurements            Json?
  la_number                  String?
  la_onlineMeeting           Json?
  la_projectLocation         String?
  la_projectValue            String?
  la_referalBonus            String?
  la_requirements            Json?
  la_showroomMeeting         Json?
  la_siteStatus              String?
  la_source                  String?
  la_specialNote             String?
  la_variant                 String?
  la_woodwork                String?
  pendingImages              Int?
  process                    String?
  site                       String?
  startTime                  String?
  cre_closing_metrics        Json?
  cre_opening_metrics        Json?
  logStatus                  LogStatus @default(CLOSED)
  fa_closing_metrics         Json?
  fa_opening_metrics         Json?
  la_closing_metrics         Json?
  la_opening_metrics         Json?
  la_project_reports         Json?
  ae_closing_metrics         Json?
  ae_opening_metrics         Json?
  ae_project_reports         Json?
  notes                      String?
  fa_project_reports         Json?
  project                    Project?  @relation(fields: [projectId], references: [id])
  user                       User      @relation(fields: [userId], references: [id])
}

model LeaveRequest {
  id              Int           @id @default(autoincrement())
  userId          Int
  type            LeaveType
  startDate       DateTime
  endDate         DateTime
  reason          String
  status          RequestStatus @default(PENDING)
  approvedBy      Int?
  createdAt       DateTime      @default(now())
  bhId            Int?
  bhStatus        RequestStatus @default(PENDING)
  hrId            Int?
  hrStatus        RequestStatus @default(PENDING)
  targetBhId      Int?
  isExceededLimit Boolean       @default(false)
  user            User          @relation(fields: [userId], references: [id])
}

model PermissionRequest {
  id              Int           @id @default(autoincrement())
  userId          Int
  date            DateTime
  startTime       String
  endTime         String
  reason          String
  status          RequestStatus @default(PENDING)
  approvedBy      Int?
  createdAt       DateTime      @default(now())
  bhId            Int?
  bhStatus        RequestStatus @default(PENDING)
  hrId            Int?
  hrStatus        RequestStatus @default(PENDING)
  targetBhId      Int?
  isExceededLimit Boolean       @default(false)
  user            User          @relation(fields: [userId], references: [id])
}

model LoginAccessRequest {
  id        Int           @id @default(autoincrement())
  userId    Int
  reason    String
  status    RequestStatus @default(PENDING)
  createdAt DateTime      @default(now())
  user      User          @relation(fields: [userId], references: [id])
}

model Project {
  id              Int       @id @default(autoincrement())
  name            String
  description     String?
  managerId       Int?
  addOns          String?
  colours         Json?
  cpCode          String?
  createdAt       DateTime  @default(now())
  fa              String?
  freezingAmount  String?
  latitude        Float?
  location        String?
  longitude       Float?
  mailId          String?
  measurements    Json?
  number          String?
  onlineMeeting   Json?
  projectValue    String?
  referalBonus    String?
  requirements    Json?
  showroomMeeting Json?
  siteStatus      String?
  source          String?
  specialNote     String?
  updatedAt       DateTime  @default(now()) @updatedAt
  variant         String?
  woodwork        String?
  clientName      String?
  googleMapLink   String?
  manager         User?     @relation(fields: [managerId], references: [id])
  workLogs        WorkLog[]
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  action    String
  userId    Int?
  details   String?
  createdAt DateTime @default(now())
}

model PopupConfig {
  id        Int       @id @default(autoincrement())
  imageUrl  String
  quote     String
  author    String
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now()) @updatedAt
  type      PopupType @default(INSPIRATIONAL)
}

model Announcement {
  id        Int              @id @default(autoincrement())
  title     String
  content   String
  type      AnnouncementType @default(INFO)
  priority  Priority         @default(LOW)
  isActive  Boolean          @default(true)
  expiresAt DateTime?
  authorId  Int
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  author    User             @relation("AuthorAnnouncements", fields: [authorId], references: [id])
}

model GlobalSetting {
  id    Int    @id @default(autoincrement())
  key   String @unique
  value String
}

model ManualPayroll {
  id                   Int      @id @default(autoincrement())
  email                String
  month                Int
  year                 Int
  allocatedSalary      Float    @default(0)
  absenteeismDeduction Float    @default(0)
  shortageDeduction    Float    @default(0)
  manualDeductions     Float    @default(0)
  netPayout            Float
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@unique([email, month, year])
}

model WfhRequest {
  id                    Int           @id @default(autoincrement())
  userId                Int
  employeeName          String
  employeeId            String
  department            String
  designation           String
  reportingManager      String
  wfhDays               Int
  startDate             DateTime
  endDate               DateTime
  realReason            String
  necessityReason       String
  impactIfRejected      String
  proofDetails          String
  primaryProject        String
  criticalReason        String
  deliverables          String
  measurableOutput      String
  deadline              String
  workingHours          String
  trackingMethod        String
  communicationPlan     String
  responseTime          Int
  environmentSetup      String
  hasDedicatedWorkspace Boolean
  hasStableInternet     Boolean
  noInterruptions       Boolean
  hasPowerBackup        Boolean
  hasSecurityCompliance Boolean
  hasErgonomicSeating   Boolean
  risksManagement       String
  failurePlan           String
  officeVisitCommitment Boolean
  hrStatus              RequestStatus @default(PENDING)
  bhStatus              RequestStatus @default(PENDING)
  adminStatus           RequestStatus @default(PENDING)
  status                RequestStatus @default(PENDING)
  currentLevel          Int           @default(1)
  remarks               String?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  user                  User          @relation(fields: [userId], references: [id])
}

enum PopupType {
  INSPIRATIONAL
  BIRTHDAY
}

enum AnnouncementType {
  INFO
  RULE
  NEWS
  EVENT
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum Role {
  EMPLOYEE
  HR
  BUSINESS_HEAD
  ADMIN
  AE_MANAGER
}

enum Status {
  ACTIVE
  BLOCKED
}

enum LeaveType {
  CASUAL
  SICK
  PAID
  HALF_DAY
  FULL_DAY
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum LogStatus {
  OPEN
  CLOSED
}

enum BreakType {
  TEA
  LUNCH
  CLIENT_MEETING
  BH_MEETING
}
